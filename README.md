# HMDM
Настройка «боевого» MDM сервера
Требования к платформе
Сервер (виртуальная машина) с Ubuntu 22.04, минимальные рекомендуемые параметры 4 Gb RAM, 2xCPU, 20 Gb SSD [Требования к высоконагруженной системе]
Публичный IP адрес
Доменное имя, соответствующее этому адресу (в примере — build.h-mdm.com)
Доступ к серверу через SSH
Открыты необходимые порты
Прямой доступ в Интернет (хотя бы на время инсталляции)
Модуль удаленного доступа (Корпоративная лицензия) требует архитектуры x86-64. Чтобы проверить, выполните команду lscpu или уточните у хостинг-провайдера.
Настройка производится под учетной записью root.

1. Установка требуемого ПО
apt update
apt install -y aapt tomcat9 postgresql vim certbot unzip net-tools
Обратите внимание:

Версия Tomcat 9, устанавливаемая через apt в Ubuntu 20.04 (9.0.31) содержит баг, связанный с передачей файлов через HTTPS. Инсталлятор Headwind MDM предложит автоматически обновить Tomcat до нужной версии — не пропускайте этот шаг.
На Ubuntu 24.04, пакет tomcat9 недоступен по умолчанию (Headwind MDM не совместим с Tomcat 10). Если установка не пройдет, выполните эту команду:
add-apt-repository -y -s "deb http://archive.ubuntu.com/ubuntu/ jammy main universe"
2. Настройка базы данных
su - postgres
psql
postgres=# CREATE USER hmdm WITH PASSWORD 'topsecret';
postgres=# CREATE DATABASE hmdm WITH OWNER=hmdm;
postgres=# \q
exit
Внимание: для большей безопасности, используйте свой пароль. Этот пароль будет использоваться на 4-м шаге при запуске скрипта установки Headwind MDM.

3. Сборка Headwind MDM
git clone https://github.com/h-mdm/hmdm-server.git
cd hmdm-server/
apt install -y maven
mvn install
Альтернатива: загрузите инсталлятор
URL последней версии инсталлятора Headwind MDM можно найти на странице «Загрузки».

wget https://h-mdm.com/files/hmdm-5.37-install-ubuntu.zip
unzip hmdm-5.37-install-ubuntu.zip
cd hmdm-install/
4. Установка Headwind MDM
Чтобы начать установку, выполните в консоли команду:

./hmdm_install.sh
При ответах на вопросы скрипта (об установке ПО, обновлении Tomcat и т.д.), рекомендуем выбирать ответы по умолчанию.

Установка Headwind MDM экран 1

Внимание: при использовании Tomcat 9, для хранения файлов нужно указывать поддиректорию, находящуюся в «песочнице Tomcat» (/var/lib/tomcat9), так как Tomcat не имеет возможности обращаться к файлам вне песочницы. Скрипты и другие файлы, не относящиеся к Tomcat, будут размещены по умолчанию в директории /opt/hmdm.

Установка Headwind MDM экран 2

Установка Headwind MDM экран 3

После этого шага, вы уже можете проверить работу панели администратора Headwind MDM, открыв в браузере адрес http://build.h-mdm.com:8080.

Если скрипт вернул ошибку «Failed to deploy WAR file», просто запустите его еще раз.

Далее инсталлятор настроит HTTPS через сервис LetsEncrypt (бесплатный генератор HTTPS-сертификатов), настроит регулярное обновление сертификатов, и загрузит нужные мобильные приложения в виде APK файлов. Мы рекомендуем следовать указаниям скрипта и на все вопросы отвечать «YES».

Установка Headwind MDM экран 4

LetsEncrypt попросит вас ввести свой email. Это безопасно, так как LetsEncrypt никогда не рассылает спам. После согласия с условиями использования, запретите отправлять вам письма, ответив «NO».

Установка Headwind MDM экран 5

5. Проверьте сервис
Проверьте, что панель администратора работает — адрес https://build.h-mdm.com должен отобразить страницу логина.

Имя пользователя и пароль по умолчанию — admin:admin (не забудьте изменить пароль, нажав на admin в верхнем правом углу экрана, и затем выбрав «Профиль»!)

Если после установки Headwind MDM вы увидите какие-либо ошибки, то их причину можно отследить через логи Tomcat. Чтобы посмотреть журнал Tomcat 9, выполните команду:

journalctl -u tomcat9.service
Сделайте резервную копию XML-конфигурации!

В Tomcat 9 есть проблема, которая может привести к удалению XML-конфигурации сервиса после обновления WAR-файла. Чтобы избежать аварии после обновления, настоятельно рекомендуем сделать резервную копию.

cp /var/lib/tomcat9/conf/Catalina/localhost/ROOT.xml /var/lib/tomcat9/conf/Catalina/localhost/ROOT.xml~
6. Настройте мобильные устройства
Откройте вкладку «Устройства» и нажмите на иконку QR кода.

Настройка Android-устройств через Headwind MDM

Правильно настроенная панель администратора откроет вам страницу с QR-кодом.
